# eF record - イーフト対戦記録アプリ 要件定義

## 概要
イーフトウイニングイレブンの対戦記録を管理するWebアプリケーション。
スマホファーストで設計し、誰でも簡単に試合結果を記録・閲覧・分析できる。

## 機能要件

### 1. ユーザー認証・管理
- **認証機能**
  - Supabase Authによるメール/パスワード認証
  - 未認証ユーザーは自動的にログインページにリダイレクト
- **プロフィール管理**
  - ユーザー名（username）とディスプレイ名（display_name）の設定
  - アバター画像のアップロード機能
  - 自分のチーム名の設定・編集機能

### 2. 試合記録機能
- **試合記録入力**
  - 対戦相手の選択（ドロップダウンから選択）
  - 自分のスコア入力（0以上の整数）
  - 相手のスコア入力（0以上の整数）
  - 試合日の設定（デフォルト：当日、編集可能）
  - メモの入力（任意：戦術、反省点など）
- **自動判定機能**
  - スコアに基づく勝敗の自動判定（勝利/引分/敗北）
  - 結果に応じた色分け表示（勝利:緑、引分:グレー、敗北:赤）
- **試合記録編集・削除**
  - 既存の試合記録の編集機能
  - 試合記録の削除機能（確認ダイアログ付き）

### 3. チーム管理機能
- **対戦相手チーム管理**
  - 新しいチームの追加機能
  - チーム名の編集機能
  - チームの削除機能（関連する試合記録も削除）
- **チーム分類**
  - 共有チーム（is_shared: true）：他のユーザーも使用可能
  - プライベートチーム（is_shared: false）：作成者のみ使用可能
- **自分のチーム名設定**
  - user_statsテーブルでの自分のチーム名管理
  - チーム名の編集・保存機能

### 4. 統計・分析機能
- **ダッシュボード統計**
  - 最近の試合結果表示
  - 現在の連勝/連敗数表示
  - 全体の勝率表示
  - 総合成績（総試合数、勝利数、引分数、敗北数）
- **対戦相手別統計**
  - 各対戦相手との通算成績
  - 得失点差の表示
  - 期間別フィルタリング（全期間/1ヶ月/1週間/3日間/今日）
  - 勝率の可視化（チャート表示）
- **統計キャッシュ機能**
  - user_statsテーブルでの統計情報キャッシュ
  - opponent_statsテーブルでの対戦相手別統計キャッシュ
  - 試合記録更新時の自動統計更新

### 5. 表示・閲覧機能
- **試合履歴一覧**
  - 時系列での試合記録表示（最新順）
  - ページネーション機能（10件ずつ表示）
  - 対戦相手別フィルタリング
  - 試合結果の色分け表示
- **メモ一覧機能**
  - メモが記録された試合の一覧表示
  - 試合日、対戦相手、結果と共にメモを表示
  - メモ内容の全文表示
- **チーム統計表示**
  - 対戦相手別の詳細統計
  - 勝率チャートの表示
  - 期間別成績の表示

### 6. データ管理・セキュリティ
- **Row Level Security (RLS)**
  - 自分の試合記録のみ作成・編集・削除可能
  - 他ユーザーの記録は閲覧のみ可能
  - プロフィールは自分のもののみ編集可能
- **データ整合性**
  - データベーストリガーによる自動統計更新
  - 試合結果の自動判定機能
  - 外部キー制約による参照整合性の保証

## 非機能要件

### パフォーマンス
- **表示速度**
  - スマホでの高速表示（3秒以内の初期表示）
  - ページネーションによる大量データの効率的な表示
  - データベースインデックスによるクエリ最適化
- **キャッシュ戦略**
  - TanStack Queryによるクライアントサイドキャッシュ
  - 統計情報のデータベースレベルでのキャッシュ

### UI/UX
- **レスポンシブデザイン**
  - スマホファーストのデザイン
  - タブレット・デスクトップでの適切な表示
- **操作性**
  - 直感的なタップ・スワイプ操作
  - 明確な視覚的フィードバック
  - アクセシビリティ対応

### セキュリティ
- **認証・認可**
  - Supabase Authによる安全な認証
  - Row Level Securityによるデータアクセス制御
- **データ保護**
  - 個人データの適切な管理
  - SQLインジェクション対策

## 技術スタック

### フロントエンド
- **フレームワーク**: Next.js 15 (App Router) + TypeScript
- **スタイリング**: Tailwind CSS 4 + shadcn/ui
- **状態管理**: TanStack Query (React Query) + Zustand
- **アイコン**: Lucide React
- **フォーム**: React Hook Form
- **ドラッグ&ドロップ**: @dnd-kit

### バックエンド・インフラ
- **データベース**: Supabase (PostgreSQL)
- **認証**: Supabase Auth
- **ホスティング**: Vercel
- **環境管理**: .env.local

### 開発ツール
- **リンター**: ESLint
- **型チェック**: TypeScript
- **パッケージマネージャー**: npm

## データベース設計

### 主要テーブル
- **profiles**: ユーザープロフィール情報
- **opponents**: 対戦相手チーム情報
- **matches**: 試合記録
- **user_stats**: ユーザー統計情報（キャッシュ）
- **opponent_stats**: 対戦相手別統計情報（キャッシュ）

### 主要機能
- 試合結果自動判定トリガー
- 統計情報自動更新トリガー
- Row Level Security ポリシー

## 画面構成

### 認証関連
1. **ログインページ** (`/auth/login`)
   - メール/パスワードによるログイン
   - 認証コールバック処理

### メイン機能
2. **ダッシュボード** (`/`)
   - 統計情報の表示
   - 最近の試合結果
   - 現在の連勝/連敗状況

3. **試合記録** 
   - **新規作成** (`/matches/new`)
   - **編集** (`/matches/[id]/edit`)

4. **試合履歴** (`/matches`)
   - 全試合の一覧表示
   - 対戦相手別フィルタリング
   - ページネーション

5. **チーム管理** (`/teams`)
   - 自分のチーム名設定
   - 対戦相手チームの管理
   - チーム編集・削除

6. **メモ一覧** (`/memos`)
   - メモ付き試合の一覧
   - メモ内容の表示

7. **チーム別統計** (`/teams/formation`)
   - 対戦相手別の詳細統計
   - 勝率チャート表示